#! /usr/bin/env bash
DISPLAYNAME=$(xrandr --listmonitors | awk '$1 == "0:" {print $4}')
CURR=$(xrandr --verbose | grep -i brightness -m 1 | cut -f2 -d ' ')
MAX=1.2

INTEL_PANEL="/sys/devices/pci0000:00/0000:00:02.0/drm/card0/card0-eDP-1/intel_backlight/"
if [[ -d $INTEL_PANEL ]]; then
    INTEL_MAX=$(cat "$INTEL_PANEL/max_brightness")
    INTEL_CURRENT=$(cat "$INTEL_PANEL/brightness")
    VAL=$(echo "$MAX*$INTEL_CURRENT/$INTEL_MAX" | bc -l)
    cat <<EOF
Intel Panel:
    Current Brightness: $INTEL_CURRENT
    Max Brightness: $INTEL_MAX

OLED:
    Current Brightness: $CURR
    Max Brightness: $MAX
    Updating Brightness: $VAL
EOF

    xrandr --output $DISPLAYNAME --brightness $VAL
else
    >2 echo "Intel panel is not found at:"
    >2 echo "$INTEL_PANEL"
fi
