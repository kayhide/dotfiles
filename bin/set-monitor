#!/bin/bash


monitor="$1"
mode="$2"
pos="${3:-0x0}"

# set-monitor eDP-1-1 2560x1440
# set-monitor DP-1-3 1920x1080 2560x0

say() {
    echo "[$(date -Iseconds)] $0"
}

is_set() {
    local line="$(xrandr -q | grep $monitor)"
    echo "$line" | grep "$mode+${pos/x/+}" > /dev/null
}

run() {
    for i in $(seq 1 5); do
        sleep 2
        if is_set; then
            return 0
        fi
        xrandr --output $monitor --mode $mode --pos $pos
    done
    return 1
}


if run; then
    say "Succeeded to set monitor mode."
else
    say "Failed to set monitor mode."
fi
